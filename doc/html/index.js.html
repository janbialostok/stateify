<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

/**
 * Converts a state-ified object back into a normal JS object
 * @param  {Object} parent An state-ified object that should be converted
 * @return {Object}        A JS object converted from state-ified object
 */
const toObject = function (parent = {}) {
  let _parent = parent;
  return Object.keys(_parent).reduce((result, key) => {
    if (_parent[key][Symbol.species] === '_state_') result[key] = _parent[key].toObject();
    else {
      if (_parent[key] &amp;&amp; typeof _parent[key] === 'object') result[key] = (Array.isArray(_parent[key])) ? Object.assign([], _parent[key]) : Object.assign({}, _parent[key]);
      else result[key] = _parent[key];
    }
    return result;
  }, (Array.isArray(_parent) ? [] : {}));
};

/**
 * Converts an object into an immutable "state" object which will never be directly manipulated but instead creates a new copy as necessary when a set, delete or get trap is triggered
 * @param {Object}  parent  The object to be converted
 * @param {Boolean} isArray Specifies that the object being converted is an Array. Must be true in order to properly handle arrays as they will be converted into non-iterable objects if isArray argument is not specified
 * @return {Object} Returns a "state" object which is a Proxy that indirectly accesses a copy of the initial object
 */
const STATEIFY = function (parent = {}, isArray = false) {
  let _parent = Object.assign((isArray) ? [] : {}, parent);
  _parent[Symbol.species] = '_state_';
  let proxy = new Proxy((isArray) ? [] : {}, {
    get: function (target, property) {
      if (property === 'inspect') return _parent;
      if (property === 'toJSON') return () => JSON.stringify(_parent);
      if (property === 'toObject') return toObject.bind(null, _parent);
      if (_parent[property] &amp;&amp; typeof _parent[property] === 'object') {
        if (_parent[property][Symbol.species] === '_state_') return _parent[property];
        _parent[property] = STATEIFY(_parent[property], Array.isArray(_parent[property]));
        return _parent[property];
      }
      else return _parent[property];
    },
    set: function (target, property, value) {
      if (property === 'inspect' || property === 'toJSON' || property === 'toObject') return true;
      _parent = Object.assign((Array.isArray(_parent) ? [] : {}), _parent, { [property]: value });
      return true;
    },
    deleteProperty: function (target, property) {
      if (property === 'inspect' || property === 'toJSON' || property === 'toObject') return true;
      _parent = Object.assign(Array.isArray(_parent[property]) ? [] : {}, _parent);
      delete _parent[property];
      return true;
    }
  });
  return proxy;
};

module.exports = STATEIFY;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#STATEIFY">STATEIFY</a></li><li><a href="global.html#toObject">toObject</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Fri Dec 30 2016 14:09:02 GMT-0500 (EST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
